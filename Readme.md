好的，遵照您的指示，我将描述所有已提供文件的功能，并将其整合成一份标准的 `README.md` 文档。

-----

# 多无人机协同任务规划仿真平台

本项目是一个用于多无人机（UAV）协同任务分配与路径规划的综合仿真与测试平台。平台旨在模拟复杂的战场或作业环境，通过多种智能算法为无人机集群分配任务，规划出无碰撞、可执行的协同飞行路径，并对不同算法的规划结果进行量化评估与对比。

## 核心功能

  * **多种任务分配算法**: 集成了三种核心的求解器，包括基于深度学习的智能体、启发式遗传算法和快速贪婪算法。
  * **高精度路径规划**: 采用RRT（快速扩展随机树）算法进行基础路径搜索，并结合PH曲线（五次贝塞尔曲线）对路径进行平滑处理，生成符合无人机运动学特性的飞行轨迹。
  * **可配置的场景生成**: 支持通过配置文件生成具有不同特征的测试场景，包括固定基准场景、强制协同场景、以及无人机或目标数量递增的扫描测试集。
  * **自动化批量测试与评估**: 提供了一个强大的批量测试框架，能够自动执行所有算法在所有场景下的测试，并生成详细的性能评估报告和数据对比CSV文件。

## 项目文件结构

### `main.py` - 主控与强化学习核心

这是项目的核心与入口文件，主要负责实现基于深度强化学习（DQN）的任务分配策略。

  * **`Config`**: 全局配置类，集中管理所有算法的超参数，如学习率、迭代次数、惩罚系数等。
  * **`DirectedGraph`**: 将任务场景（无人机、目标）抽象成一个有向图，用于快速估算节点间的近似距离，极大地提升了RL和启发式算法的评估速度。
  * **`UAVTaskEnv`**: 强化学习的环境类，定义了状态空间、动作空间、奖励函数以及环境的动态转移逻辑。
  * **`GraphRLSolver`**: 核心的强化学习求解器。它内部包含一个简单的神经网络（`GNN`）作为Q值函数逼近器，并实现了完整的DQN算法流程，包括经验回放（`replay`）、探索-利用（Epsilon-Greedy）策略和模型训练（`train`）。
  * **`calculate_economic_sync_speeds`**: 关键的后处理函数。它接收一个初步的“任务序列”，并将其解析为包含精确路径、同步到达时间和飞行速度的最终可执行计划。**此函数被所有求解器（RL, GA, Greedy）共享**，以确保最终规划流程的统一性。
  * **`visualize_task_assignments`**: 统一的可视化函数，负责将最终的规划方案绘制成详细的任务分配图，并生成包含资源消耗、飞行路径等信息的文本报告。

### `GASolver.py` - 遗传算法求解器

实现了遗传算法（GA）作为一种启发式的对比求解器。

  * **`GeneticAlgorithm`**: 封装了GA的核心操作。它使用一种“目标槽位”染色体编码方式，并通过选择、交叉、变异等算子进行种群进化。其适应度函数（`evaluate_fitness`）同样基于`DirectedGraph`进行快速评估。
  * **`heuristic_reinforcement_operator`**: 一个特别的“修复”算子，用于在每一代中主动修正染色体，例如将闲置的无人机分配给未满足的目标，以提升解的质量。
  * **`GASolver`**: GA求解器的封装类。它负责完整地运行`GeneticAlgorithm`的进化流程，并将最终找到的最优染色体解码为任务序列，再调用`calculate_economic_sync_speeds`生成最终计划。

### `GreedySolver.py` - 贪婪算法求解器

实现了一个快速、逻辑简单的贪婪算法，作为性能基准。

  * **`GreedySolver`**: 其核心`solve`方法在一个循环中不断决策。在每一步，它会从所有“可能且有效”的（无人机-目标）分配中，选择一个成本最低（飞行时间最短）的立即执行，并更新场景状态。
      * 关键优化在于，它只考虑能产生实际资源贡献的分配，有效避免了死循环。
      * 与GA类似，它也只生成任务序列，并依赖`calculate_economic_sync_speeds`完成最终规划。

### `batch_tester.py` - 批量测试与评估框架

用于自动化执行大规模对比实验的脚本。

  * **`evaluate_plan`**: 核心评估函数。它接收一个最终计划，并计算出十余项详细的量化评估指标，如目标满足率、资源完成率、负载均衡度、总航程、综合得分等。
  * **`run_single_test`**: 执行一次单独的测试，能够根据传入的参数（如求解器名称）调用相应的算法流程。
  * **`batch_test`**: 主测试函数。它能自动扫描场景文件夹，并按配置循环执行所有场景与所有求解器的组合测试。支持断点续传，并将所有评估结果追加保存到CSV文件中，便于后续进行数据分析和图表绘制。

### `data_generator.py` - 测试场景生成器

用于按需生成大量、多样化的测试场景，并以`.pkl`格式保存。

  * **`SCENARIO_GENERATION_CONFIG`**: 一个字典，定义了不同场景模式的生成规则。
  * **`ScenarioGenerator`**: 核心生成器类。支持生成多种模式的场景，包括：
      * `specified`: 一个固定的、用于算法基准对比的场景。
      * `collaborative`: 目标所需资源高于任何单个无人机的能力，强制需要协同才能完成的场景。
      * `uav_sweep_*`: 无人机数量从少到多变化的“扫描”系列场景，用于测试算法的可扩展性。
      * 包含了确保资源总供给大于总需求的逻辑，保证了生成场景的有效性。

### `scenarios.py` - 预定义场景

提供少量硬编码的、可直接引用的场景数据，方便快速进行开发调试。

  * 包含`get_small_scenario`、`get_complex_scenario`等函数，每个函数返回一组固定的无人机、目标和障碍物列表。

### `path_planning.py` - 路径规划模块

封装了所有与路径计算和障碍物相关的底层算法。

  * **`Obstacle`, `CircularObstacle`, `PolygonalObstacle`**: 定义了不同形状的障碍物，并实现了它们各自的碰撞检测算法。
  * **`RRTPlanner`**: 实现了标准的快速扩展随机树（RRT）算法，用于在有障碍物的环境中快速搜索出一条可行的路径。
  * **`PHCurveRRTPlanner`**: 更高级的规划器。它首先调用`RRTPlanner`生成粗略路径，然后使用PH曲线（具体为五次贝塞尔曲线）对路径进行平滑处理，生成连续、光滑、符合无人机飞行特性的最终轨迹。

### `entities.py` - 核心实体定义

定义了整个项目中两个最核心的数据结构。

  * **`UAV`**: 无人机类，包含了ID、位置、资源、航程、速度等所有静态和动态属性。
  * **`Target`**: 目标类，包含了ID、位置、资源需求、价值等属性。

## 如何运行

1.  **生成场景数据 (可选)**
    如果 `scenarios` 文件夹为空或想生成新的测试数据，请运行：

    ```bash
    python data_generator.py
    ```

2.  **运行独立算法测试 (用于调试)**
    可以单独运行每个求解器文件，来测试其在一个默认场景下的表现：

    ```bash
    python main.py         # 测试强化学习算法
    python GASolver.py       # 测试遗传算法
    python GreedySolver.py   # 测试贪婪算法
    ```

3.  **执行批量对比测试 (主要)**
    这是项目的主要入口，用于执行全面的算法对比实验：

    ```bash
    python batch_tester.py
    ```

    该脚本会默认测试 `scenarios/specified` 目录下的场景，并为所有已配置的求解器生成规划结果、图片、报告和一份包含所有性能指标的 `batch_test_results.csv` 文件。您也可以直接修改此文件末尾的`batch_test`函数调用，来执行更广泛的测试。

## 主要依赖项

  * `numpy`
  * `matplotlib`
  * `pandas`
  * `torch`
  * `tqdm`